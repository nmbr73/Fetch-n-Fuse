{"Shader":{"ver":"0.1","info":{"id":"ftccRM","date":"1659411640","viewed":107,"name":"Sunset Clouds","username":"wyatt","description":"Cumulative image of clouds with 2D lighting","likes":14,"published":3,"flags":32,"usePreview":0,"tags":["noise","sunset","fbm"],"hasliked":0},"renderpass":[{"inputs":[{"id":259,"src":"\/media\/previz\/buffer02.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":37,"channel":0}],"code":"Main {\n    Q = .9*A(U);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"#define R iResolution.xy\n#define Main void mainImage(out vec4 Q, in vec2 U)\n#define A(U) texture(iChannel0,(U)\/R)\n#define B(U) texture(iChannel1,(U)\/R)\n#define C(U) texture(iChannel2,(U)\/R)","name":"Common","description":"","type":"common"},{"inputs":[],"outputs":[{"id":257,"channel":0}],"code":"float hash(vec3 p3)\n{\n\tp3  = fract(p3 * .1031);\n    p3 += dot(p3, p3.zyx + 31.32);\n    return fract((p3.x + p3.y) * p3.z);\n}\n#define ei(a) mat2(cos(a),sin(a),-sin(a),cos(a))\n\nfloat noise ( vec3 h ) {\n    vec3 f = floor(h);\n    vec3 c = ceil(h);\n    vec3 r = fract(h);\n    float _000 = hash(f),\n          _001 = hash(vec3(f.xy,c.z)),\n          _010 = hash(vec3(f.x,c.y,f.z)),\n          _011 = hash(vec3(f.x,c.yz)),\n          _100 = hash(vec3(c.x,f.yz)),\n          _101 = hash(vec3(c.x,f.y,c.z)),\n          _110 = hash(vec3(c.xy,f.z)),\n          _111 = hash(c),\n          _00 = mix(_000,_001,r.z),\n          _01 = mix(_010,_011,r.z),\n          _10 = mix(_100,_101,r.z),\n          _11 = mix(_110,_111,r.z),\n          _0 = mix(_00,_01,r.y),\n          _1 = mix(_10,_11,r.y);\n          return mix(_0,_1,r.x);\n}\nfloat fbm (vec3 p)\n{\n    float w = 0.;\n    float N = 10.;\n    for (float i = 1.; i < N; i++)\n    {\n        p.xy *= 2.*ei(2.);\n        p.yz *= ei(1.);\n        w += 4.*noise(p)\/N*pow(2.,-i);\n    }\n    return w;\n}\nMain {\n    U = 3.*(U-.5*R)\/R.y;\n    U.xy +=1.5;\n    vec3 v = 2.*vec3(U,3.-.2*float(iFrame)\/60.);\n    float w = fbm(v)-.02;\n    w *= 1.5*exp(.05*v.z);\n    w *= .8*smoothstep(-5.,1.,exp(-v.x)-v.y+.5*v.z-2.);\n    w = smoothstep(.12,0.21,w);\n    Q = vec4(w*w);\n    \n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":257,"src":"\/media\/previz\/buffer00.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":258,"channel":0}],"code":"Main {\n    Q = vec4(1);\n    for (float x = 0.; x < 40.; x++){\n        float a = A(U+4.*vec2(x,.3*x)).x;\n        Q -= .01*Q*a;\n    }\n    Q = vec4(1,2,3,4)*.2+Q*sin(.5+Q-(1.1-sqrt(float(iFrame)\/60.)*.2)+vec4(1,2,3,4));\n    Q.w = A(U).x;\n}","name":"Buffer B","description":"","type":"buffer"},{"inputs":[{"id":258,"src":"\/media\/previz\/buffer01.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":259,"src":"\/media\/previz\/buffer02.png","ctype":"buffer","channel":2,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":259,"channel":0}],"code":"Main {\n    Q = A(U);\n    Q = mix(C(U),Q*Q,Q.w);\n    \n    if (iFrame < 1) {\n        Q = \n        .5+.5*sin(5.+U.y\/R.y+vec4(1,2,3,4));\n    }\n}","name":"Buffer C","description":"","type":"buffer"}]}}