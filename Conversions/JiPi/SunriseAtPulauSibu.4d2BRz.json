{"Shader":{"ver":"0.1","info":{"id":"4d2BRz","date":"1499159009","viewed":2228,"name":"Sunrise at Pulau Sibu","username":"glkt","description":"use the mouse for time-lapse","likes":66,"published":3,"flags":0,"usePreview":0,"tags":["clouds","water","sky","sunrise","swiminginthesea"],"hasliked":0},"renderpass":[{"inputs":[{"id":8,"src":"\/media\/a\/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","ctype":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":47,"src":"\/media\/a\/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","ctype":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":37,"channel":0}],"code":"\/\/ Man has demonstrated that he is master of everything except his own nature\n\/\/---------------------------------------------------------------------------\n\n\/\/ One morning we woke up when the sky was still dark.\n\/\/ We walked half an hour through the forest,\n\/\/ to reach the other side of the island,\n\/\/ where the beach is facing the rising sun.\n\/\/ The sun was already there, one half over the horizon.\n\/\/ The sky was on fire.\n\/\/ We swum in the sea, staring at the rising sun.\n\n\/\/ visual parameters -------------------\nconst vec3 sunColor = vec3(1.5,.9,.7);\nconst vec3 lightColor = vec3(1.,.8,.7);\nconst vec3 darkColor = vec3(.2,.2,.3);\nconst vec3 baseSkyColor = vec3(.6,.7,.8);\nconst vec3 seaColor = vec3(.1,.3,.5);\nconst vec3 seaLight = vec3(.1,.45,.55);\n\/\/---------------------------------------\n\nvec3 gamma( vec3 col, float g){\n    return pow(col,vec3(g));\n}\n    \n    \n\/\/ clouds layered noise\nfloat noiseLayer(vec2 uv){    \n    float t = (iTime+iMouse.x)\/5.;\n    uv.y -= t\/60.; \/\/ clouds pass by\n    float e = 0.;\n    for(float j=1.; j<9.; j++){\n        \/\/ shift each layer in different directions\n        float timeOffset = t*mod(j,2.989)*.02 - t*.015;\n        e += 1.-texture(iChannel0, uv * (j*1.789) + j*159.45 + timeOffset).r \/ j ;\n    }\n    e \/= 3.5;\n    return e;\n}\n\n\/\/ waves layered noise\nfloat waterHeight(vec2 uv){\n    float t = (iTime+iMouse.x);\n    float e = 0.;\n    for(float j=1.; j<6.; j++){\n        \/\/ shift each layer in different directions\n        float timeOffset = t*mod(j,.789)*.1 - t*.05;\n        e += texture(iChannel1, uv * (j*1.789) + j*159.45 + timeOffset).r \/ j ;\n    }\n    e \/= 6.;\n    return e;\n}\n\nvec3 waterNormals(vec2 uv){\n    uv.x *= .25;\n    float eps = 0.008;    \n    vec3 n=vec3( waterHeight(uv) - waterHeight(uv+vec2(eps,0.)),\n                 1.,\n                 waterHeight(uv) - waterHeight(uv+vec2(0.,eps)));\n   return normalize(n);\n}\t\n\n\nvec3 drawSky( vec2 uv, vec2 uvInit){ \n        \n\tfloat clouds = noiseLayer(uv);\n    \n    \/\/ clouds normals\n    float eps = 0.1;\n    vec3 n = vec3(\tclouds - noiseLayer(uv+vec2(eps,0.)),\n            \t\t-.3,\n             \t\tclouds - noiseLayer(uv+vec2(0.,eps)));\n    n = normalize(n);\n    \n    \/\/ fake lighting\n    float l = dot(n, normalize(vec3(uv.x,-.2,uv.y+.5)));\n    l = clamp(l,0.,1.);\n    \n    \/\/ clouds color\t(color gradient from light)\n    vec3 cloudColor = mix(baseSkyColor, darkColor, length(uvInit)*1.7);\n    cloudColor = mix( cloudColor,sunColor, l );\n    \n    \/\/ sky color (color gradient on Y)\n    vec3 skyColor = mix(lightColor , baseSkyColor, clamp(uvInit.y*2.,0.,1.) );\n    skyColor = mix ( skyColor, darkColor, clamp(uvInit.y*3.-.8,0.,1.) );\n    skyColor = mix ( skyColor, sunColor, clamp(-uvInit.y*10.+1.1,0.,1.) );\n    \n\t\/\/ draw sun\n    if(length(uvInit-vec2(0.,.04) )<.03){\n     \tskyColor += vec3(2.,1.,.8);\n    }\n       \n   \t\/\/ mix clouds and sky\n    float cloudMix = clamp(0.,1.,clouds*4.-8.);\n    vec3 color = mix( cloudColor, skyColor, clamp(cloudMix,0.,1.) );\n    \n    \/\/ draw islands on horizon\n    uvInit.y = abs(uvInit.y);\n    float islandHeight = texture(iChannel1, uvInit.xx\/2.+.67).r\/15. - uvInit.y + .978;\n    islandHeight += texture(iChannel1, uvInit.xx*2.).r\/60.;\n    islandHeight = clamp(floor(islandHeight),0.,1.);    \n    vec3 landColor = mix(baseSkyColor, darkColor, length(uvInit)*1.5);\n    color = mix(color, landColor, islandHeight);\n\n    return color;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    \/\/ center uv around horizon and manage ratio\n\tvec2 uvInit = fragCoord.xy \/ iResolution.xy;\n    uvInit.x -= .5;\n    uvInit.x *= iResolution.x\/iResolution.y;\t\n    uvInit.y -= 0.35;\n    \n    \/\/ perspective deform \n    vec2 uv = uvInit;\n    uv.y -=.01;\n\tuv.y = abs(uv.y);\n    uv.y = log(uv.y)\/2.;\n    uv.x *= 1.-uv.y;\n    uv *= .2;\n    \n    vec3 col = vec3(1.,1.,1.);\n    \n    \/\/ draw water\n    if(uvInit.y < 0.){       \n       \n        vec3 n = waterNormals(uv);\n        \n        \/\/ draw reflection of sky into water\n        vec3 waterReflections = drawSky(uv+n.xz, uvInit+n.xz);\n\n        \/\/ mask for fore-ground green light effect in water\n        float transparency = dot(n, vec3(0.,.2,1.5));        \n        transparency -= length ( (uvInit - vec2(0.,-.35)) * vec2(.2,1.) );\n\t\ttransparency = (transparency*12.+1.5);\n        \n        \/\/ add foreground water effect\n        waterReflections = mix( waterReflections, seaColor, clamp(transparency,0.,1.) );\n        waterReflections = mix( waterReflections, seaLight, max(0.,transparency-1.5) );\n\n       \tcol = waterReflections;\n        \n        \/\/ darken sea near horizon\n       \tcol = mix(col, col*vec3(.6,.8,1.), -uv.y);\n        \n        \/\/sun specular\n        col += max(0.,.02-abs(uv.x+n.x))* 8000. * vec3(1.,.7,.3) * -uv.y * max(0.,-n.z);\n        \n    }else{      \n        \n        \/\/ sky\n        col = drawSky(uv, uvInit);\n    }\n    \n    \/\/ sun flare & vignette\n    col += vec3(1.,.8,.6) * (0.55-length(uvInit)) ;\n    \n    \/\/ \"exposure\" adjust\n    col *= .75;\n    col = gamma(col,1.3);\n    \n    fragColor = vec4(col,1.);\n}\n\n\/\/--------------------------------------------------------------------\n\/\/There is no salvation in becoming adapted to a world which is crazy.","name":"Image","description":"","type":"image"}]}}