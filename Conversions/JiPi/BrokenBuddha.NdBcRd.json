{"Shader":{"ver":"0.1","info":{"id":"NdBcRd","date":"1643904761","viewed":80,"name":"Broken Buddha","username":"eiffie","description":"The best fractals are broken fractals.","likes":17,"published":3,"flags":40,"usePreview":0,"tags":["buddhabrot"],"hasliked":0},"renderpass":[{"inputs":[{"id":257,"src":"\/media\/previz\/buffer00.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":37,"channel":0}],"code":"\/\/broken buddha by eiffie \n\/\/track the position of points near the border of the mandelbrot set as they orbit\n#define time iTime\n#define rez iResolution.xy\n\nvoid mainImage(out vec4 O, in vec2 U){\n  O=texture(iChannel0,U\/rez.xy);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":257,"src":"\/media\/previz\/buffer00.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":257,"channel":0}],"code":"#define time iTime\n#define rez iResolution.xy\n#define pi 3.14159\nvec4 load(float x, float y){return texture(iChannel0,vec2(x+.5,y+.5)\/rez.xy);}\nmat2 rmat(float a){return mat2(cos(a),sin(a),-sin(a),cos(a));}\nvec2 cmul(vec2 a, vec2 b){return vec2(a.x*b.x-a.y*b.y,dot(a,b.yx));}\nvoid mainImage(out vec4 O, in vec2 U){\n  O=texture(iChannel0,U\/rez.xy);\n  U=floor(U);\n  vec4 L=load(0.,0.);\n  float f=float(iFrame);\n  float a=floor(f)*0.001;\n  \n  if(U.x+U.y==0.){\n    int iters=int(floor(a))+7;\n    a*=pi;\n    vec2 p=vec2(cos(a),sin(a\/1.5)),rd=-p;p.x-=.5*cos(a*.007);\n    for(int i=0;i<32;i++){\n      float dr=1.,r=length(p);\n      vec2 C=p,Z=p;\n      for(int n=0;n<iters && r<2000.;n++){\n        Z=cmul(Z,Z)+C;\n        dr=dr*r*2.+1.;\n        r=length(Z);\n      }\n      p+=rd*.5*log(r)*r\/dr;\n    }\n    p+=rd*(1.+cos(a*.3))*.1;\n    O=vec4(p.x,p.y,p.x,p.y); \n  }else{\n    vec2 p0=L.xy;\n    vec2 u=(2.*U-rez.xy)\/rez.y;\n    for(int j=0;j<5;j++){\n      vec2 p=p0+vec2(0.001)*float(j);\n      for(int n=0;n<20 && dot(p,p)<300000.;n++){\n        p=cmul(p,p)+p0;\n        float d=length(abs(u)-abs(p));d=smoothstep(2.\/rez.y,0.0,d)*.2;\/\/\/(1.+40.*O.r*O.r);\n        vec3 col=vec3(d*p*rmat(a*7.+float(j)*0.3),d);\n        col.yz*=rmat(a*5.+float(j+n)*.03);\n        O+=vec4(abs(col.grb),0.);\n      }\n    }\n    O=O*.995;\n  }\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"#define bps 2.5\n#define pi 3.14159\nint N[8]=int[8](0,4,2,4,5,7,9,5);\nfloat scale(float note){\/\/throws out dissonant tones \n float n2=mod(note,12.); \n if((n2==1.)||(n2==6.)||(n2==8.)||(n2==10.))note=-100.; \n return note; \n}\n\/\/ note number to frequency  from https:\/\/www.shadertoy.com\/view\/ldfSW2 \nfloat ntof(int n0){\n float n=scale(float(n0));\n return (n>0.)?440.0 * pow(2.0, (float(n) - 67.0) \/ 12.0):0.0;\n} \nvec2 rot(vec2 v, float a) {return cos(a)*v+sin(a)*vec2(v.y,-v.x);}\nvec2 I(int n, float t, vec3 p, vec4 e, vec4 d){\n  float bt=t,t2,t3,t4,f=ntof(n);\n  if(f==0.)return vec2(0);\n  t-=t*d.y*sin((d.w*pi+t)*pi*d.z);t3=t*d.x;\n  t2=fract(t*p.y*f);t4=fract(t3*p.y*f);\n  t=fract(t*f);t3=fract(t3*f);\n  float amp=abs(1.+cos(bt*e.z*pi)*e.w)*exp(-bt*e.y)*(1.0-exp(-bt*e.x))*min(1.,100.-bt*100.);\n  return amp*rot(vec2(sin(pow(t,p.x)*pi*2.+pi*2.*p.z*sin(pow(t2,p.x)*pi*2.)),\n    sin(pow(t3,p.x)*pi*2.+pi*2.*p.z*sin(pow(t4,p.x)*pi*2.))),float(n)+bt*pi*2.);\n}\n\nvec2 mainSound(int samp, float time){\n  float tim=time*bps;if(tim>80.)tim-=80.;if(tim>80.)tim+=48.+128.;\n  float bt=floor(tim),t=fract(tim);\n  int n1=N[int(bt\/64.)%8];\n  int n0=n1+N[int(bt\/8.)%8],n=n0+N[int(bt)%8],n2=n0+N[int(bt\/2.)%8],n4=n0+N[int(bt\/4.)%8];\n  const vec4 dtn=vec4(1.014,0.005,1.,.5);\n  vec2 v=I(n+60,t,vec3(1.-t*.5,1.,t),vec4(.25,1.,18.,t*.6),dtn)*.25;\n  \n  t=fract(tim\/2.); \n  float fo=pow(1.-t,20.0);\n  v+=I(n2+60,t,vec3(1.-fo*.5,1.5,fo),vec4(1.,4.0,24.,t*.8),dtn);\n  \n  t=fract(tim\/4.);\n  fo=pow(1.-t,20.0);\n  v+=I(n4+67,t,vec3(1.-fo*.5,1.5,fo),vec4(1.,4.0,36.,t*.8),dtn);\n  \n  t=fract(tim\/8.);\n  fo=pow(1.-t,20.0);\n  v+=I(n0+60,t,vec3(1.-fo*.5,1.5,fo),vec4(1.,2.0,48.,t*.6),dtn);\n  return v*.2;\n}","name":"Sound","description":"","type":"sound"}]}}