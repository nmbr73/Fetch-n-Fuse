{"Shader":{"ver":"0.1","info":{"id":"4tKBDc","date":"1544339897","viewed":1931,"name":"Thermal Particles","username":"wyatt","description":"Mouseable particle experiment inspired by Fabrice\n\nI have way more to learn, but right now I think the Universe is a whole lot of bubbles that swim, dance, and twirl and are connected by love and creativity","likes":51,"published":3,"flags":32,"usePreview":0,"tags":["physics"],"hasliked":0},"renderpass":[{"inputs":[{"id":257,"src":"\/media\/previz\/buffer00.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":260,"src":"\/media\/previz\/buffer03.png","ctype":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":37,"channel":0}],"code":"\/*\nI plan on doing a few iterations of this\nthe physics is definitely not realistic yet\nbut it's a good practical start\n\nThe idea is that the particles sit in a fluid of smaller particles\ntheir interaction with the fluid determines the force field around them\nin this setup, the force is very weak and inaccurate. I plan on improving that.\nThe particles bounce off each other because of an interaction with the field that is \nthe drawing of the particles.\n\n*\/\n\n\nvec2 R;\nvec4 T ( vec2 U ) {return texture(iChannel0,U\/R);}\nvec4 P ( vec2 U ) {return texture(iChannel1,U\/R);}\nvoid mainImage( out vec4 Q, in vec2 U )\n{\n    R = iResolution.xy;\n   \tvec4 t = T(U);\n   \tvec4 p = P(U);\n    Q.xyz = 0.5+0.5*sin(1.5*(2.*t.w+t.z*vec3(1,2,3)));\n}\n","name":"Image","description":"","type":"image"},{"inputs":[{"id":259,"src":"\/media\/previz\/buffer02.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":260,"src":"\/media\/previz\/buffer03.png","ctype":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":257,"channel":0}],"code":"vec2 R;\nvec4 T ( vec2 U ) {return texture(iChannel0,U\/R);}\nvec4 P ( vec2 U ) {return texture(iChannel1,U\/R);}\n\/\/ This is my normal fluid interaction with a minor variation\nfloat X (vec2 U, vec2 u, inout vec4 Q, in vec2 r) {\n    vec2 V = U + r, v = T(V).xy;\n    vec4 t = T (V-v);\n    \/\/ the \"w\" channel contributes to the force interaction\n    Q.xy -= 0.25*r*(t.z-Q.z+t.w-Q.w); \n    return (0.5*(length(r-v+u)-length(r+v-u))+t.z);\n}\n\nvoid mainImage( out vec4 Q, in vec2 U )\n{   R = iResolution.xy;\n \tvec2 u = T(U).xy, e = vec2(1,0);\n \tQ = T(U-u);\n \tvec4 p = P(U-u);\n \t\/\/ The particles sit in a damped fluid\n \tQ.z = 0.25*(X(U,u,Q,e)+X(U,u,Q,-e)+X(U,u,Q,e.yx)+X(U,u,Q,-e.yx));\n\t\/\/ the particles interact with the space so i just draw a circle where they are\n \tQ.w =  sign(p.x)*smoothstep(2.,0.,length(U-abs(p.xy)));\n \t\/\/ the pressure is damped so that it doesn't go too crazy\n \tQ.z *= 0.96;\n \t\/\/ make a little pressure and density where the mouse is\n \tif (iMouse.z > 0.) Q.w = mix(Q.w,3.,exp(-.1*dot(U-iMouse.xy,U-iMouse.xy)));\n \tif (iFrame < 1) Q = vec4(0);\n    if (U.x < 1.||U.y < 1.||R.x-U.x < 1.||R.y-U.y < 1.) Q.xy = vec2(0);\n\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":257,"src":"\/media\/previz\/buffer00.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":260,"src":"\/media\/previz\/buffer03.png","ctype":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":258,"channel":0}],"code":"vec2 R;\nvec4 T ( vec2 U ) {return texture(iChannel0,U\/R);}\nvec4 P ( vec2 U ) {return texture(iChannel1,U\/R);}\n\/\/ This is my normal fluid interaction with a minor variation\nfloat X (vec2 U, vec2 u, inout vec4 Q, in vec2 r) {\n    vec2 V = U + r, v = T(V).xy;\n    vec4 t = T (V-v);\n    \/\/ the \"w\" channel contributes to the force interaction\n    Q.xy -= 0.25*r*(t.z-Q.z+t.w-Q.w); \n    return (0.5*(length(r-v+u)-length(r+v-u))+t.z);\n}\n\nvoid mainImage( out vec4 Q, in vec2 U )\n{   R = iResolution.xy;\n \tvec2 u = T(U).xy, e = vec2(1,0);\n \tQ = T(U-u);\n \tvec4 p = P(U-u);\n \t\/\/ The particles sit in a damped fluid\n \tQ.z = 0.25*(X(U,u,Q,e)+X(U,u,Q,-e)+X(U,u,Q,e.yx)+X(U,u,Q,-e.yx));\n\t\/\/ the particles interact with the space so i just draw a circle where they are\n \tQ.w =  sign(p.x)*smoothstep(2.,0.,length(U-abs(p.xy)));\n \t\/\/ the pressure is damped so that it doesn't go too crazy\n \tQ.z *= 0.96;\n \t\/\/ make a little pressure and density where the mouse is\n \tif (iMouse.z > 0.) Q.w = mix(Q.w,3.,exp(-.1*dot(U-iMouse.xy,U-iMouse.xy)));\n \tif (iFrame < 1) Q = vec4(0);\n    if (U.x < 1.||U.y < 1.||R.x-U.x < 1.||R.y-U.y < 1.) Q.xy = vec2(0);\n\n}","name":"Buffer B","description":"","type":"buffer"},{"inputs":[{"id":258,"src":"\/media\/previz\/buffer01.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":260,"src":"\/media\/previz\/buffer03.png","ctype":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":259,"channel":0}],"code":"vec2 R;\nvec4 T ( vec2 U ) {return texture(iChannel0,U\/R);}\nvec4 P ( vec2 U ) {return texture(iChannel1,U\/R);}\n\/\/ This is my normal fluid interaction with a minor variation\nfloat X (vec2 U, vec2 u, inout vec4 Q, in vec2 r) {\n    vec2 V = U + r, v = T(V).xy;\n    vec4 t = T (V-v);\n    \/\/ the \"w\" channel contributes to the force interaction\n    Q.xy -= 0.25*r*(t.z-Q.z+t.w-Q.w); \n    return (0.5*(length(r-v+u)-length(r+v-u))+t.z);\n}\n\nvoid mainImage( out vec4 Q, in vec2 U )\n{   R = iResolution.xy;\n \tvec2 u = T(U).xy, e = vec2(1,0);\n \tQ = T(U-u);\n \tvec4 p = P(U-u);\n \t\/\/ The particles sit in a damped fluid\n \tQ.z = 0.25*(X(U,u,Q,e)+X(U,u,Q,-e)+X(U,u,Q,e.yx)+X(U,u,Q,-e.yx));\n\t\/\/ the particles interact with the space so i just draw a circle where they are\n \tQ.w =  sign(p.x)*smoothstep(2.,0.,length(U-abs(p.xy)));\n \t\/\/ the pressure is damped so that it doesn't go too crazy\n \tQ.z *= 0.96;\n \t\/\/ make a little pressure and density where the mouse is\n \tif (iMouse.z > 0.) Q.w = mix(Q.w,3.,exp(-.1*dot(U-iMouse.xy,U-iMouse.xy)));\n \tif (iFrame < 1) Q = vec4(0);\n    if (U.x < 1.||U.y < 1.||R.x-U.x < 1.||R.y-U.y < 1.) Q.xy = vec2(0);\n\n}","name":"Buffer C","description":"","type":"buffer"},{"inputs":[{"id":259,"src":"\/media\/previz\/buffer02.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":260,"src":"\/media\/previz\/buffer03.png","ctype":"buffer","channel":1,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":260,"channel":0}],"code":"\/\/ Voronoi based particle tracking\n\nvec2 R;float N;\nvec4 T ( vec2 U ) {return texture(iChannel0,U\/R);}\/\/sample fluid\nvec4 P ( vec2 U ) {return texture(iChannel1,U\/R);}\/\/sample particles\nvoid swap (vec2 U, inout vec4 Q, vec2 u) {\n    vec4 p = P(U+u);\n    float dl = length(U-abs(Q.xy)) - length(U-abs(p.xy));\n    Q = mix(Q,p,float(dl>0.));\n}\nvoid mainImage( out vec4 Q, in vec2 U )\n{   R = iResolution.xy;\n \tQ = P(U);\n \t\/\/ exchange information with neighbors to find particles\n \tswap(U,Q,vec2(1,0));\n \tswap(U,Q,vec2(0,1));\n \tswap(U,Q,vec2(0,-1));\n \tswap(U,Q,vec2(-1,0));\n \tswap(U,Q,vec2(3,0));\n \tswap(U,Q,vec2(0,3));\n \tswap(U,Q,vec2(0,-3));\n \tswap(U,Q,vec2(-3,0));\n \t\/\/ find this particle fluid state\n \tvec4 t = T(Q.xy);\n \tvec2 e = vec2(1,0);\n \t\/\/ find neighbor fluid states\n \tvec4 \n        a = T(Q.xy+e.xy),\n        b = T(Q.xy+e.yx),\n        c = T(Q.xy-e.xy),\n        d = T(Q.xy-e.yx);\n \t\/\/ accelerate this particle in the direction of the z and w fields\n \t\/\/ z field is force at a distance. the particles displace the fluid and create a pressure field\n \t\/\/ w field is the discritized particle. its just a drawing of where they are\n \t\/\/ but when they get close they transfer energies because they interact with the radial drawing of the particle and push away\n \tQ.zw = Q.zw*0.95+vec2(a.z-c.z,b.z-d.z)-vec2(a.w-c.w,b.w-d.w);\n \t\/\/ the particle moves in the diredction of its momentum\n \tQ.xy += .1*Q.zw;\n \t\n \t\n \tif (iFrame < 1) { \/\/ I don't know why the init looks so cool in practice, I just wanted a grid\n     \tQ = vec4(floor(U\/10.)*10.,U);\n    }\n}","name":"Buffer D","description":"","type":"buffer"}]}}